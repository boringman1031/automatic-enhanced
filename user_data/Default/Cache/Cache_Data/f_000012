import{c,ab as te,b3 as Je,b4 as Xe,b5 as Ze,b6 as ea,aW as aa,j as e,aX as ta,b7 as na,b8 as sa,b9 as la,aa as oa,aV as ra,S as y,T as ia,D as T,f as z,X as O,A as re,Q as Ge,a as he,Y as P,H as ca,P as ua,ao as da,ap as ha,U as ga,L as ma,aq as J,I as Q,Z as pa,d as fa,J as xa,ba as _a,ag as X,s as ba,v as A,N as va}from"./index-DH9E0Dqq.js";import{F as ge,B as me,P as pe,S as fe,b as $}from"./PaginationControl-CenqpxQH.js";import{a as B,D as G}from"./hook-4gwLvy6S.js";import{I as w}from"./InputLabel-D5TVACTd.js";import{d as j,S as N,B as xe}from"./DatePicker-DAUzD4hQ.js";import{u as Sa,g as ja,a as Ca,b as Oa,c as ya,d as Na,e as Da,f as La,h as Aa}from"./hook-BRgLX0dN.js";import{A as Ea,q as _e,N as $a,O as Ra,Q as Ia,f as Ma}from"./ArrowUpward-2KjtWO5g.js";import{C as Ya,a as ka}from"./CardContent-Buvwad75.js";import"./BasicInput-D0G2rzCO.js";function Pa(n,t){var a,s;return c.isValidElement(n)&&t.indexOf((a=n.type.muiName)!=null?a:(s=n.type)==null||(s=s._payload)==null||(s=s.value)==null?void 0:s.muiName)!==-1}const Ta=(n,t)=>n.filter(a=>t.includes(a)),Z=(n,t,a)=>{const s=n.keys[0];Array.isArray(t)?t.forEach((i,r)=>{a((u,l)=>{r<=n.keys.length-1&&(r===0?Object.assign(u,l):u[n.up(n.keys[r])]=l)},i)}):t&&typeof t=="object"?(Object.keys(t).length>n.keys.length?n.keys:Ta(n.keys,Object.keys(t))).forEach(r=>{if(n.keys.indexOf(r)!==-1){const u=t[r];u!==void 0&&a((l,x)=>{s===r?Object.assign(l,x):l[n.up(r)]=x},u)}}):(typeof t=="number"||typeof t=="string")&&a((i,r)=>{Object.assign(i,r)},t)};function F(n){return n?`Level${n}`:""}function ne(n){return n.unstable_level>0&&n.container}function we(n){return function(a){return`var(--Grid-${a}Spacing${F(n.unstable_level)})`}}function be(n){return function(a){return n.unstable_level===0?`var(--Grid-${a}Spacing)`:`var(--Grid-${a}Spacing${F(n.unstable_level-1)})`}}function ve(n){return n.unstable_level===0?"var(--Grid-columns)":`var(--Grid-columns${F(n.unstable_level-1)})`}const Ga=({theme:n,ownerState:t})=>{const a=we(t),s={};return Z(n.breakpoints,t.gridSize,(i,r)=>{let u={};r===!0&&(u={flexBasis:0,flexGrow:1,maxWidth:"100%"}),r==="auto"&&(u={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof r=="number"&&(u={flexGrow:0,flexBasis:"auto",width:`calc(100% * ${r} / ${ve(t)}${ne(t)?` + ${a("column")}`:""})`}),i(s,u)}),s},wa=({theme:n,ownerState:t})=>{const a={};return Z(n.breakpoints,t.gridOffset,(s,i)=>{let r={};i==="auto"&&(r={marginLeft:"auto"}),typeof i=="number"&&(r={marginLeft:i===0?"0px":`calc(100% * ${i} / ${ve(t)})`}),s(a,r)}),a},Ha=({theme:n,ownerState:t})=>{if(!t.container)return{};const a=ne(t)?{[`--Grid-columns${F(t.unstable_level)}`]:ve(t)}:{"--Grid-columns":12};return Z(n.breakpoints,t.columns,(s,i)=>{s(a,{[`--Grid-columns${F(t.unstable_level)}`]:i})}),a},Ua=({theme:n,ownerState:t})=>{if(!t.container)return{};const a=be(t),s=ne(t)?{[`--Grid-rowSpacing${F(t.unstable_level)}`]:a("row")}:{};return Z(n.breakpoints,t.rowSpacing,(i,r)=>{var u;i(s,{[`--Grid-rowSpacing${F(t.unstable_level)}`]:typeof r=="string"?r:(u=n.spacing)==null?void 0:u.call(n,r)})}),s},Fa=({theme:n,ownerState:t})=>{if(!t.container)return{};const a=be(t),s=ne(t)?{[`--Grid-columnSpacing${F(t.unstable_level)}`]:a("column")}:{};return Z(n.breakpoints,t.columnSpacing,(i,r)=>{var u;i(s,{[`--Grid-columnSpacing${F(t.unstable_level)}`]:typeof r=="string"?r:(u=n.spacing)==null?void 0:u.call(n,r)})}),s},Ba=({theme:n,ownerState:t})=>{if(!t.container)return{};const a={};return Z(n.breakpoints,t.direction,(s,i)=>{s(a,{flexDirection:i})}),a},Wa=({ownerState:n})=>{const t=we(n),a=be(n);return te({minWidth:0,boxSizing:"border-box"},n.container&&te({display:"flex",flexWrap:"wrap"},n.wrap&&n.wrap!=="wrap"&&{flexWrap:n.wrap},{margin:`calc(${t("row")} / -2) calc(${t("column")} / -2)`},n.disableEqualOverflow&&{margin:`calc(${t("row")} * -1) 0px 0px calc(${t("column")} * -1)`}),(!n.container||ne(n))&&te({padding:`calc(${a("row")} / 2) calc(${a("column")} / 2)`},(n.disableEqualOverflow||n.parentDisableEqualOverflow)&&{padding:`${a("row")} 0px 0px ${a("column")}`}))},Ka=n=>{const t=[];return Object.entries(n).forEach(([a,s])=>{s!==!1&&s!==void 0&&t.push(`grid-${a}-${String(s)}`)}),t},qa=(n,t="xs")=>{function a(s){return s===void 0?!1:typeof s=="string"&&!Number.isNaN(Number(s))||typeof s=="number"&&s>0}if(a(n))return[`spacing-${t}-${String(n)}`];if(typeof n=="object"&&!Array.isArray(n)){const s=[];return Object.entries(n).forEach(([i,r])=>{a(r)&&s.push(`spacing-${i}-${String(r)}`)}),s}return[]},za=n=>n===void 0?[]:typeof n=="object"?Object.entries(n).map(([t,a])=>`direction-${t}-${a}`):[`direction-xs-${String(n)}`],Va=["className","children","columns","container","component","direction","wrap","spacing","rowSpacing","columnSpacing","disableEqualOverflow","unstable_level"],Qa=Je(),Ja=Xe("div",{name:"MuiGrid",slot:"Root",overridesResolver:(n,t)=>t.root});function Xa(n){return na({props:n,name:"MuiGrid",defaultTheme:Qa})}function Za(n={}){const{createStyledComponent:t=Ja,useThemeProps:a=Xa,componentName:s="MuiGrid"}=n,i=c.createContext(void 0),r=(x,h)=>{const{container:f,direction:v,spacing:d,wrap:g,gridSize:o}=x,m={root:["root",f&&"container",g!=="wrap"&&`wrap-xs-${String(g)}`,...za(v),...Ka(o),...f?qa(d,h.breakpoints.keys[0]):[]]};return sa(m,b=>la(s,b),{})},u=t(Ha,Fa,Ua,Ga,Ba,Wa,wa),l=c.forwardRef(function(h,f){var v,d,g,o,m,b,p,S;const _=Ze(),C=a(h),D=ea(C),R=c.useContext(i),{className:I,children:L,columns:E=12,container:M=!1,component:ee="div",direction:H="row",wrap:Ue="wrap",spacing:ie=0,rowSpacing:Fe=ie,columnSpacing:Be=ie,disableEqualOverflow:Se,unstable_level:q=0}=D,We=aa(D,Va);let ae=Se;q&&Se!==void 0&&(ae=h.disableEqualOverflow);const je={},Ce={},Oe={};Object.entries(We).forEach(([Y,V])=>{_.breakpoints.values[Y]!==void 0?je[Y]=V:_.breakpoints.values[Y.replace("Offset","")]!==void 0?Ce[Y.replace("Offset","")]=V:Oe[Y]=V});const Ke=(v=h.columns)!=null?v:q?void 0:E,qe=(d=h.spacing)!=null?d:q?void 0:ie,ze=(g=(o=h.rowSpacing)!=null?o:h.spacing)!=null?g:q?void 0:Fe,Ve=(m=(b=h.columnSpacing)!=null?b:h.spacing)!=null?m:q?void 0:Be,ye=te({},D,{level:q,columns:Ke,container:M,direction:H,wrap:Ue,spacing:qe,rowSpacing:ze,columnSpacing:Ve,gridSize:je,gridOffset:Ce,disableEqualOverflow:(p=(S=ae)!=null?S:R)!=null?p:!1,parentDisableEqualOverflow:R}),Qe=r(ye,_);let ce=e.jsx(u,te({ref:f,as:ee,ownerState:ye,className:ta(Qe.root,I)},Oe,{children:c.Children.map(L,Y=>{if(c.isValidElement(Y)&&Pa(Y,["Grid"])){var V,Ne;return c.cloneElement(Y,{unstable_level:(V=(Ne=Y.props)==null?void 0:Ne.unstable_level)!=null?V:q+1})}return Y})}));return ae!==void 0&&ae!==(R??!1)&&(ce=e.jsx(i.Provider,{value:ae,children:ce})),ce});return l.muiName="Grid",l}const k=Za({createStyledComponent:oa("div",{name:"MuiGrid2",slot:"Root",overridesResolver:(n,t)=>t.root}),componentName:"MuiGrid2",useThemeProps:n=>ra({props:n,name:"MuiGrid2"})}),et=["登入","觀看個人資訊","觀看排行榜","觀看魔王戰史","觀看個人資訊知識卡","討論(文字對話)","進入穿梭","穿梭時更換戰寵","穿梭時更換導師(正確)","更換導師(錯誤)","穿梭時點選知識卡","進入戰鬥","出卡(正確)","出卡(錯誤)","戰寵提示(系統主動)","戰寵提示(學員發動)","回合結束(成功)","回合結束(失敗)","AI導師_背景更換","AI導師_AI導師更換","AI導師提問送出","進入黑洞任務","黑洞觀察家","進行黑洞關卡","進入油料任務","油料任務答題正確","油料任務答題錯誤","油料任務完成並結算","回收行動","新手任務進行","新手任務領獎","簽到","AI導師更換頁面","觀看新手任務頁面","觀看簽到頁面(自動)","觀看簽到頁面(主動)"],at=[{label:"全部",value:"全部"},...et.map(n=>({label:n,value:n}))],tt=[{label:"單人",value:"單人"},{label:"協作",value:"協作"},{label:"陣營",value:"陣營"},{label:"黑洞",value:"黑洞"}],De=(n,t)=>{const a=Object.keys(t).join(","),s=Object.entries(t).map(([i,r])=>r==="全部"?"":i==="shownicknamelist"?`${i}=${r.join(",")}`:i==="nickname"?r.reduce((u,l)=>u?`${u}&${i}=${l}`:`${i}=${l}`,""):`${i}=${r}`).join("&");return`${n}${s}#hide_parameters=${a}&titled=false`},nt=()=>{const[n,t]=c.useState(""),[a,s]=c.useState(""),[i,r]=c.useState({mode:"單人",starttimestamp:j().subtract(1,"month").format("YYYY-MM-DD HH:mm:ss"),endtimestamp:j().format("YYYY-MM-DD HH:mm:ss"),operationname:"全部",missionname:"",roomname:"",nickname:[],shownicknamelist:[]}),{data:u}=Sa(),{data:l}=B({variable:"BEHAVIOR_LOG_URL",page:0,size:10,onlySelf:!1}),x=(g,o)=>{r(m=>({...m,[g]:o.target.value}))},h=(g,o)=>{r(m=>({...m,[g]:o.target.value}))},f=(g,o)=>{r(m=>({...m,nickname:o,shownicknamelist:o}))},v=(g,o)=>{o&&r(m=>({...m,[g]:j(o).format("YYYY-MM-DD HH:mm:ss")}))},d=()=>{t(De(a,i))};return c.useEffect(()=>{l!=null&&l.content[0]&&(s((l==null?void 0:l.content[0].value)+"?"),t(De((l==null?void 0:l.content[0].value)+"?",i)))},[l]),e.jsxs("div",{style:{height:"100vh",width:"100%"},children:[e.jsxs(y,{flexDirection:"row",width:"100%",gap:3,mb:3,alignItems:"center",flexWrap:"wrap",children:[e.jsx(G,{label:"開始時間",format:"YYYY-MM-DD HH:mm:ss",value:j(i.starttimestamp).toDate().getTime(),onChange:g=>v("starttimestamp",g)}),e.jsx(G,{label:"結束時間",format:"YYYY-MM-DD HH:mm:ss",value:j(i.endtimestamp).toDate().getTime(),onChange:g=>v("endtimestamp",g)}),e.jsx(N,{label:"模式",options:tt,value:i.mode,onChange:g=>x("mode",g)}),e.jsx(N,{label:"行為模式",options:at,value:i.operationname,onChange:g=>x("operationname",g)}),e.jsx(Ea,{multiple:!0,value:i.nickname,onChange:f,options:u||[],getOptionLabel:g=>g,sx:{width:"20%"},renderInput:g=>e.jsx(ia,{...g,variant:"standard",label:"玩家暱稱",placeholder:"請選擇玩家暱稱"})}),e.jsx(w,{label:"任務名稱",labelSx:{width:"100%"},value:i.missionname,onChange:g=>h("missionname",g)}),e.jsx(w,{label:"房間名稱",labelSx:{width:"100%"},value:i.roomname,onChange:g=>h("roomname",g)}),e.jsx(T,{label:"搜尋",onClick:d,btnColor:"BROWN"})]}),e.jsx("iframe",{height:"100%",width:"100%",src:n},n)]})},st=nt,lt=["一年級","二年級","三年級","四年級","五年級","六年級","國一","國二","國三","高一","高二","高三","大一","大二","大三","大四"],ot=lt.map((n,t)=>({label:n,value:t+1})),rt=Array.from({length:12},(n,t)=>{const a=String(t+1).padStart(2,"0");return["A","B","C","D"].map(s=>({label:`${a}${s}`,value:`${a}${s}`}))}).flat(),Le=(n,t)=>{const a=Object.keys(t).join(","),s=Object.entries(t).filter(([i,r])=>r!=="全部"&&r!==0&&r!=="").map(([i,r])=>`${i}=${r}`).join("&");return`${n}${s}#hide_parameters=${a}&titled=false`},it=()=>{const{userInfo:n,role:t}=z(),a=n.schoolDtoList.map(g=>({label:g.schoolName,value:g.schoolName})),[s,i]=c.useState(""),[r,u]=c.useState(""),[l,x]=c.useState({grade:1,level:"全部",schoolname:t===O.ROLE_ADMIN||t===O.ROLE_MANAGER?"":a?a[0].value:"",nickname:"",isadmin:t===O.ROLE_ADMIN?1:0}),{data:h}=B({variable:"LEARNING_LOG_URL",page:0,size:10,onlySelf:!1}),f=(g,o)=>{x(m=>({...m,[g]:o.target.value}))},v=(g,o)=>{x({...l,[g]:o})},d=()=>{i(Le(r,l))};return c.useEffect(()=>{h!=null&&h.content[0]&&(u((h==null?void 0:h.content[0].value)+"?"),i(Le((h==null?void 0:h.content[0].value)+"?",l)))},[h]),e.jsxs("div",{style:{height:"100vh",width:"100%"},children:[e.jsxs(y,{flexDirection:"row",width:"100%",gap:3,mb:3,alignItems:"center",flexWrap:"wrap",children:[e.jsx(N,{label:"年級",options:ot,value:l.grade,onChange:g=>f("grade",g)}),e.jsx(N,{label:"等級",options:[{label:"全部",value:"全部"},...rt],value:l.level,onChange:g=>f("level",g)}),t===O.ROLE_ADMIN||t===O.ROLE_MANAGER?e.jsx(w,{label:"學校名稱",labelSx:{width:"80%"},value:l.schoolname,onChange:g=>v("schoolname",g.target.value)}):e.jsx(N,{label:"學校名稱",options:a,value:l.schoolname,onChange:g=>v("schoolname",g.target.value)}),e.jsx(w,{label:"遊戲暱稱",labelSx:{width:"100%"},value:l.nickname,onChange:g=>v("nickname",g.target.value)}),e.jsx(T,{label:"搜尋",onClick:d,btnColor:"BROWN"})]}),e.jsx("iframe",{height:"100%",width:"100%",src:s},s)]})},ct=it,U=class U{};U.RANK="/personalPage/ranking/all",U.RANKING="/personalPage/ranking",U.RANK_GRADE="/personalPage/ranking/",U.RANK_GRADE_ALL="/personalPage/ranking/all",U.PAGE_RANKING="/personalPage/page/ranking",U.PAGE_RANKING_ALL="/personalPage/page/ranking/all",U.PAGE_SCHOOL_RANKING="/personalPage/page/schoolRanking";let K=U;async function Ae(n,t){return(await re.get(K.PAGE_RANKING,{params:n,signal:t,paramsSerializer:{serialize:s=>_e.stringify(s,{arrayFormat:"repeat"})}})).data.data}async function ut(n,t){return(await re.get(K.PAGE_RANKING_ALL,{params:n,signal:t,paramsSerializer:{serialize:s=>_e.stringify(s,{arrayFormat:"repeat"})}})).data.data}async function dt(n,t){return(await re.get(K.PAGE_SCHOOL_RANKING,{params:n,signal:t,paramsSerializer:{serialize:s=>_e.stringify(s,{arrayFormat:"repeat"})}})).data.data}function He(n){const t=Ge(n),a=Array.from({length:16},(s,i)=>i+1);return he({queryKey:n.gradeList==="allPlayer"?[`${K.PAGE_RANKING_ALL}${t}`]:[`${K.PAGE_RANKING}${t}`],queryFn:({signal:s})=>n.gradeList==="allPlayer"?ut({...n,gradeList:a},s):n.gradeList==="allStudent"?Ae({...n,gradeList:a},s):Ae(n,s)})}function ht(n){const t=Ge(n),a=Array.from({length:16},(s,i)=>i+1);return he({queryKey:[`${K.PAGE_SCHOOL_RANKING}${t}`],queryFn:({signal:s})=>dt(n.gradeList==="allStudent"?{...n,gradeList:a}:n,s)})}const gt=c.memo(({open:n,setOpen:t,schoolName:a})=>{const{role:s}=z(),[i,r]=c.useState(1),[u,l]=c.useState(1),x=c.useMemo(()=>({page:i-1,size:20,schoolName:a,gradeList:"allStudent"}),[i,a]),h=c.useCallback(()=>{t(!1),r(1),l(1)},[t]),{data:f,isLoading:v,isSuccess:d}=He(x),g=c.useMemo(()=>(f==null?void 0:f.content.map((S,_)=>({...S,rankNum:x.page*x.size+(_+1)})))||[],[f,x.page,x.size]),o=c.useMemo(()=>!!f&&d&&!!f.content.length,[d,f]),m=c.useCallback((S,_)=>{l(_),r(_)},[]),b=c.useCallback(()=>{u&&r(u)},[u]),p=[{title:"名次",dataField:"rankNum"},{title:"遊戲暱稱",dataField:"nickName"},{title:"年級",dataField:"classString"},{title:"學校名稱",dataField:"schoolName"},...s===O.ROLE_ADMIN?[{title:"學生名稱",dataField:"realName",component:S=>e.jsx(P,{variant:"h5",children:S.realName})}]:[],{title:"總積分",dataField:"point"}];return e.jsxs(ca,{open:n,onClose:h,maxWidth:!1,fullWidth:!0,children:[e.jsx(ua,{children:e.jsx(y,{direction:"row",justifyContent:"end",children:e.jsx(da,{onClick:h,children:e.jsx(ha,{})})})}),e.jsx(ga,{children:v?e.jsx(ma,{}):e.jsx(ge,{isVisible:o,children:e.jsxs(y,{spacing:2,alignItems:"center",children:[e.jsx(me,{columns:p,rows:g}),e.jsx(pe,{totalPages:(f==null?void 0:f.totalPages)||0,currentPage:x.page,inputPage:u,setInputPage:l,handlePageChange:m,handlePageSearch:b})]})})})]})}),mt=[{label:"全體玩家",value:"allStudent"},{label:"國小",value:1},{label:"國中",value:7},{label:"高中",value:10},{label:"大學",value:13}],pt=()=>{const{userInfo:n,role:t}=z(),a=[{label:"全部",value:"全部"},...n.schoolDtoList.map(L=>({label:L.schoolName,value:L.schoolName}))],[s,i]=c.useState({schoolName:t===O.ROLE_ADMIN||t===O.ROLE_MANAGER?"":a?a[0].value:"",gradeList:"allStudent",page:0,size:20}),[r,u]=c.useState(""),[l,x]=c.useState(!1),h=c.useCallback(L=>{u(L),x(!0)},[]),[f,v]=c.useState(s),[d,g]=c.useState(1),{data:o,isSuccess:m}=ht({...f,schoolName:f.schoolName=="全部"?"":f.schoolName}),b=c.useMemo(()=>!!o&&m&&!!o.content.length,[m,o]),p=L=>{i({...s,schoolName:L})},S=L=>{const E=L.target.value;let M="";switch(E){case"allStudent":M="allStudent";break;case 1:M=Array.from({length:6},(ee,H)=>H+Number(E));break;case 7:M=Array.from({length:3},(ee,H)=>H+Number(E));break;case 10:M=Array.from({length:3},(ee,H)=>H+Number(E));break;case 13:M=Array.from({length:4},(ee,H)=>H+Number(E));break}i({...s,gradeList:M})},_=(L,E,M)=>{i({...L,page:M}),v({...E,page:M})},C=c.useCallback((L,E)=>{_(s,f,E-1),g(E)},[s,f]),D=c.useCallback(()=>{d&&_(s,f,d-1)},[d,s,f]),R=()=>{_(s,s,0),g(1)},I=[{title:"名次",dataField:"rankNum"},{title:"學校名稱",dataField:"schoolName"},{title:"註冊人數",dataField:"registeredCount"},{title:"得分人數",dataField:"scoredParticipantCount"},{title:"總積分",dataField:"score"},{title:"玩家名單",dataField:"playerList",component:L=>e.jsx(T,{label:"檢視",onClick:()=>h(L.schoolName),btnColor:"BTN_LATTE_GRAY"})}];return e.jsxs(y,{width:"100%",gap:3,children:[e.jsxs(y,{flexDirection:"row",width:"100%",gap:3,px:3,mb:3,alignItems:"center",flexWrap:"wrap",children:[t===O.ROLE_ADMIN||t===O.ROLE_MANAGER?e.jsx(w,{label:"學校名稱",labelSx:{width:"80%"},value:s.schoolName,onChange:L=>p(L.target.value),onKeyDown:L=>J(L,R)}):e.jsx(N,{label:"學校名稱",options:a,value:s.schoolName,onChange:L=>p(L.target.value)}),e.jsx(N,{label:"對象",options:mt,value:typeof s.gradeList=="string"?s.gradeList:s.gradeList[0],onChange:S}),e.jsx(T,{label:"搜尋",onClick:R,btnColor:"BROWN"})]}),o&&e.jsx(ge,{isVisible:b,children:e.jsxs(y,{p:.5,alignItems:"center",gap:5,children:[e.jsx(me,{columns:I,rows:o.content}),e.jsx(pe,{totalPages:o.totalPages,currentPage:o.pageable.pageNumber,inputPage:d,setInputPage:g,handlePageChange:C,handlePageSearch:D})]})},JSON.stringify(f)),e.jsx(gt,{open:l,setOpen:x,schoolName:r})]})},ft=pt,xt=[{label:"全體玩家",value:"allPlayer"},{label:"全體學生",value:"allStudent"},{label:"國小",value:1},{label:"國中",value:7},{label:"高中",value:10},{label:"大學",value:13}],_t=()=>{const{userInfo:n,role:t}=z(),a=[{label:"全部",value:"全部"},...n.schoolDtoList.map(_=>({label:_.schoolName,value:_.schoolName}))],[s,i]=c.useState({nickName:"",schoolName:t===O.ROLE_ADMIN||t===O.ROLE_MANAGER?"":a?a[0].value:"",gradeList:"allPlayer",page:0,size:20}),[r,u]=c.useState(s),{data:l,isSuccess:x}=He({...r,schoolName:r.schoolName=="全部"?"":r.schoolName}),h=c.useMemo(()=>!!l&&x&&!!l.content.length,[x,l]),[f,v]=c.useState(),d=(_,C)=>{i({...s,[_]:C})},g=_=>{const C=_.target.value;let D="";switch(C){case"allPlayer":D="allPlayer";break;case"allStudent":D="allStudent";break;case 1:D=Array.from({length:6},(R,I)=>I+Number(C));break;case 7:D=Array.from({length:3},(R,I)=>I+Number(C));break;case 10:D=Array.from({length:3},(R,I)=>I+Number(C));break;case 13:D=Array.from({length:4},(R,I)=>I+Number(C));break}i({...s,gradeList:D})},o=c.useCallback((_,C,D)=>{i({..._,page:D}),u({...C,page:D})},[]),m=(_,C)=>{o(s,r,C-1),v(C)},b=()=>{o(s,s,0),v(1)},p=c.useCallback(()=>{f&&o(s,s,Number(f)-1)},[f,s,o]),S=[{title:"",dataField:"rankChange",width:"100px",component:_=>{let C;_.rankChange>0?C=e.jsx($a,{sx:{color:Q.GREEN}}):_.rankChange<0?C=e.jsx(Ra,{sx:{color:Q.RED}}):_.rankChange===0?C=e.jsx(P,{sx:{mx:"auto"},children:"-"}):C=e.jsx(P,{sx:{mx:"auto",color:Q.GREEN,fontWeight:"bold"},children:"NEW"});const D=_.rankChange<0?Q.RED:Q.GREEN;return e.jsxs(y,{sx:{flexDirection:"row",alignItems:"center",gap:"4px"},children:[C,_.rankChange!==0&&e.jsx(P,{sx:{color:D,textWrap:"nowrap"},variant:"h6",children:_.rankChange&&Math.abs(_.rankChange)})]})}},{title:"名次",dataField:"rankNum",width:"100px"},{title:"遊戲暱稱",dataField:"nickName"},{title:"學校名稱",dataField:"schoolName"},...t===O.ROLE_ADMIN?[{title:"學生名稱",dataField:"realName",component:_=>e.jsx(P,{variant:"h5",children:_.realName})}]:[],{title:"總積分",dataField:"point"},{title:"積分變化",dataField:"pointChange",component:_=>{const C=_.pointChange>0?`+ ${_.pointChange}`:0;return e.jsx(P,{variant:"h5",children:C})}}];return e.jsxs(y,{width:"100%",gap:3,children:[e.jsxs(y,{flexDirection:"row",width:"100%",gap:3,px:3,mb:3,alignItems:"center",flexWrap:"wrap",children:[e.jsx(w,{label:"遊戲暱稱",labelSx:{width:"80%"},value:s.nickName,onChange:_=>d("nickName",_.target.value),onKeyDown:_=>J(_,b)}),t===O.ROLE_ADMIN||t===O.ROLE_MANAGER?e.jsx(w,{label:"學校名稱",labelSx:{width:"80%"},value:s.schoolName,onChange:_=>d("schoolName",_.target.value),onKeyDown:_=>J(_,b)}):e.jsx(N,{label:"學校名稱",options:a,value:s.schoolName,onChange:_=>d("schoolName",_.target.value)}),e.jsx(N,{label:"對象",options:xt,value:typeof s.gradeList=="string"?s.gradeList:s.gradeList[0],onChange:g}),e.jsx(T,{label:"搜尋",onClick:b,btnColor:"BROWN"})]}),l&&e.jsx(ge,{isVisible:h,children:e.jsxs(y,{p:.5,alignItems:"center",gap:5,children:[e.jsx(me,{columns:S,rows:l.content}),e.jsx(pe,{totalPages:l.totalPages,currentPage:l.pageable.pageNumber,inputPage:f??1,setInputPage:v,handlePageChange:m,handlePageSearch:p})]})},JSON.stringify(r))]})},bt=_t,vt=()=>{const[n,t]=c.useState(""),{data:a}=B({variable:"LOGIN_AND_PLAYING_TIME_WITH_30DAY_LOG_URL",page:0,size:10,onlySelf:!1});return c.useEffect(()=>{a!=null&&a.content[0]&&t(a==null?void 0:a.content[0].value)},[a]),e.jsx("div",{style:{height:"90vh",width:"100%"},children:e.jsx("iframe",{height:"100%",width:"100%",src:n},n)})},St=vt;function jt(){var t;const n=pa({queries:[{queryKey:["allPlayerCount"],queryFn:({signal:a})=>ja(a)},{queryKey:["totalLoginTimes"],queryFn:({signal:a})=>Ca(a)},{queryKey:["totalStageChallengeTimes"],queryFn:({signal:a})=>Oa(a)},{queryKey:["todayLoginTimes"],queryFn:({signal:a})=>ya(a)},{queryKey:["todayStageChallengeTimes"],queryFn:({signal:a})=>Na(a)},{queryKey:["totalLoginDuration"],queryFn:({signal:a})=>Da(a)},{queryKey:["maximalLoginDuration"],queryFn:({signal:a})=>La(a)},{queryKey:["averageLoginDuration"],queryFn:({signal:a})=>Aa(a)}]});return{data:n.map(a=>a.data),isLoading:n.some(a=>a.isLoading),error:(t=n.find(a=>a.isError))==null?void 0:t.error}}function W({title:n,content:t,isBigger:a,CardSx:s}){return e.jsx(Ya,{sx:{flex:1,minHeight:"240px",textAlign:"center",border:`1px solid ${Q.TAB_BG_GRAY}`,transition:"0.3s ease",cursor:"pointer",...s},children:e.jsxs(ka,{sx:{textAlign:"center"},children:[e.jsx(P,{variant:"h4",component:"div",sx:{borderBottom:"1px solid #aaa",py:2},children:n}),e.jsx(P,{mt:5,variant:a?"h2":"h5",sx:{fontWeight:700,mt:a?"30%":"10%"},children:t})]})})}function Ct(){var l,x,h,f,v;const n=fa(),{data:t,isLoading:a,error:s}=jt(),i=()=>{const d=t[5];return`${d==null?void 0:d.year}年 ${d==null?void 0:d.month}月 ${d==null?void 0:d.day}天 ${d==null?void 0:d.hour}小時 ${d==null?void 0:d.minute}分 `},r=()=>{const d=t[6];return`${d==null?void 0:d.hour}小時 ${d==null?void 0:d.minute}分 ${d==null?void 0:d.second}秒`},u=()=>{const d=t[7];return`${d==null?void 0:d.hour}小時 ${d==null?void 0:d.minute}分 ${d==null?void 0:d.second}秒`};return e.jsxs(y,{sx:{flexGrow:1,gap:1},children:[a&&!s?e.jsx(xa,{type:"image"}):e.jsxs(e.Fragment,{children:[e.jsxs(k,{container:!0,spacing:2,children:[e.jsx(k,{xs:12,md:5,lg:4,children:e.jsx(W,{title:"時空學園總人數",content:`${(l=t[0])==null?void 0:l.toString()}人`,CardSx:{height:500},isBigger:!0})}),e.jsxs(k,{container:!0,xs:12,md:7,lg:8,spacing:2,children:[e.jsx(k,{xs:6,lg:6,children:e.jsx(W,{title:"登入總次數",content:`總次數: ${(x=t[1])==null?void 0:x.toString()}次`})}),e.jsx(k,{xs:6,lg:6,children:e.jsx(W,{title:"關卡挑戰總次數",content:`總次數: ${(h=t[2])==null?void 0:h.toString()}次`})}),e.jsx(k,{xs:6,lg:6,children:e.jsx(W,{title:"本日登入次數",content:`今日次數: ${(f=t[3])==null?void 0:f.toString()}次`})}),e.jsx(k,{xs:6,lg:6,children:e.jsx(W,{title:"本日關卡挑戰次數",content:`今日次數: ${(v=t[4])==null?void 0:v.toString()}次`})})]})]}),e.jsxs(k,{container:!0,spacing:2,children:[e.jsx(k,{xs:6,md:4,children:e.jsx(W,{title:"所有玩家登入總時長",content:i()})}),e.jsx(k,{xs:6,md:4,children:e.jsx(W,{title:"最長上線時間",content:r()})}),e.jsx(k,{xs:6,md:4,children:e.jsx(W,{title:"平均登入時間",content:u()})})]})]}),e.jsx(_a,{variant:"contained",color:"primary",sx:{md:4,ml:"auto"},onClick:()=>n("/monitor/studentMonthStats"),children:"近30天數據"})]})}const Ot=["一年級","二年級","三年級","四年級","五年級","六年級","國一","國二","國三","高一","高二","高三","大一","大二","大三","大四"],yt=Ot.map((n,t)=>({label:n,value:t+1})),se=[{label:"全部",value:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},{label:"國小",value:[1,2,3,4,5,6]},{label:"國中",value:[7,8,9]},{label:"高中",value:[10,11,12]},{label:"大學",value:[13,14,15,16]}],Ee=(n,t)=>{var u;const a={...t};a.start_date=j(a.start_date).startOf("day").format("YYYY-MM-DD HH:mm:ss"),a.end_date=j(a.end_date).endOf("day").format("YYYY-MM-DD HH:mm:ss"),a.grades===0&&a.school_level&&(a.grades=a.school_level.join(",")),((u=a.school_level)==null?void 0:u.length)===se[0].value.length&&(a.grades=""),Array.isArray(a.school_level)&&a.school_level.length===se[0].value.length&&(delete a.school_level,delete a.grades);const i=[...Object.keys(a),"grades"].join(","),r=Object.entries(a).filter(([l,x])=>x!==void 0&&x!=="").map(([l,x])=>`${l}=${x}`).join("&");return console.log(`${n}${r}#hide_parameters=${i}&titled=false`),`${n}${r}#hide_parameters=${i}&titled=false`},Nt=()=>{var g;const{userInfo:n,role:t}=z(),a=n.schoolDtoList.map(o=>({label:o.schoolName,value:o.schoolName})),[s,i]=c.useState(""),[r,u]=c.useState(""),[l,x]=c.useState({grades:0,school_level:se[0].value,school_name:t===O.ROLE_ADMIN||t===O.ROLE_MANAGER?"":(g=a[0])==null?void 0:g.value,start_date:j().subtract(1,"month").startOf("day").format("YYYY-MM-DD HH:mm:ss"),end_date:j().endOf("day").format("YYYY-MM-DD HH:mm:ss"),is_admin:t===O.ROLE_ADMIN?1:null}),{data:h}=B({variable:"CUSTOM_DATE_RANGE_PLAYER_LOGIN_AND_PLAY_DASHBOARD",page:0,size:10,onlySelf:!1}),f=c.useCallback((o,m)=>{o==="grades"&&m.target.value?x(b=>({...b,[o]:m.target.value,school_level:[]})):o==="school_level"&&m.target.value?x(b=>({...b,[o]:m.target.value,grades:0})):x(b=>({...b,[o]:m.target.value}))},[]),v=c.useCallback((o,m)=>{x(b=>({...b,[o]:m}))},[]),d=c.useCallback(()=>{i(Ee(r,l))},[r,l]);return c.useEffect(()=>{h!=null&&h.content[0]&&(u(h.content[0].value+"?"),i(Ee(h.content[0].value+"?",l)))},[h]),e.jsxs("div",{style:{height:"100vh",width:"100%"},children:[e.jsxs(y,{flexDirection:"row",width:"100%",gap:3,mb:3,alignItems:"center",flexWrap:"wrap",children:[e.jsx(N,{label:"學制",options:se,value:l.school_level||[],onChange:o=>f("school_level",o),minWidth:"100px"}),e.jsx(N,{label:"年級",options:yt,value:l.grades||0,onChange:o=>f("grades",o),minWidth:"100px"}),t===O.ROLE_ADMIN||t===O.ROLE_MANAGER?e.jsx(w,{label:"學校名稱",labelSx:{width:"80%"},value:l.school_name,onChange:o=>f("school_name",o),onKeyDown:o=>J(o,d)}):e.jsx(N,{label:"學校名稱",options:a,value:l.school_name,onChange:o=>f("school_name",o)}),e.jsxs(X,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsx(G,{label:"開始時間",format:"YYYY-MM-DD",value:j(l.start_date).toDate().getTime(),onChange:o=>v("start_date",o)}),e.jsx(G,{label:"結束時間",format:"YYYY-MM-DD",value:j(l.end_date).toDate().getTime(),onChange:o=>v("end_date",o)})]}),e.jsx(T,{label:"搜尋",onClick:d,btnColor:"BROWN"})]}),e.jsx("iframe",{height:"100%",width:"100%",src:s},s)]})},Dt=Nt,Lt=["一年級","二年級","三年級","四年級","五年級","六年級","國一","國二","國三","高一","高二","高三","大一","大二","大三","大四"],At=Lt.map((n,t)=>({label:n,value:t+1})),ue=[{label:"全部",value:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},{label:"國小",value:[1,2,3,4,5,6]},{label:"國中",value:[7,8,9]},{label:"高中",value:[10,11,12]},{label:"大學",value:[13,14,15,16]}],$e=(n,t)=>{const a={...t};a.start_date=j(a.start_date).startOf("day").format("YYYY-MM-DD HH:mm:ss"),a.end_date=j(a.end_date).endOf("day").format("YYYY-MM-DD HH:mm:ss"),a.grades===0&&a.school_level&&(a.grades=a.school_level.join(",")),Array.isArray(a.school_level)&&a.school_level.length===ue[0].value.length&&(delete a.school_level,delete a.grades);const i=[...Object.keys(a),"grades"].join(","),r=Object.entries(a).filter(([u,l])=>l!==void 0&&l!=="").map(([u,l])=>`${u}=${l}`).join("&");return`${n}${r}#hide_parameters=${i}&titled=false`},Et=()=>{var g;const{userInfo:n,role:t}=z(),a=n.schoolDtoList.map(o=>({label:o.schoolName,value:o.schoolName})),[s,i]=c.useState(""),[r,u]=c.useState(""),[l,x]=c.useState({grades:0,school_level:ue[0].value,school_name:t===O.ROLE_ADMIN||t===O.ROLE_MANAGER?"":(g=a[0])==null?void 0:g.value,start_date:j().subtract(1,"month").startOf("day").format("YYYY-MM-DD"),end_date:j().endOf("day").format("YYYY-MM-DD"),is_admin:t===O.ROLE_ADMIN?1:null}),{data:h}=B({variable:"CUSTOM_DATE_RANGE_PLAYER_LIST",page:0,size:10,onlySelf:!1}),f=c.useCallback((o,m)=>{o==="grades"&&m.target.value?x(b=>({...b,[o]:m.target.value,school_level:[]})):o==="school_level"&&m.target.value?x(b=>({...b,[o]:m.target.value,grades:0})):x(b=>({...b,[o]:m.target.value}))},[]),v=c.useCallback((o,m)=>{x(b=>({...b,[o]:m}))},[]),d=c.useCallback(()=>{i($e(r,l))},[r,l]);return c.useEffect(()=>{h!=null&&h.content[0]&&(u(h.content[0].value+"?"),i($e(h.content[0].value+"?",l)))},[h]),e.jsxs("div",{style:{height:"100vh",width:"100%"},children:[e.jsxs(y,{flexDirection:"row",width:"100%",gap:3,mb:3,alignItems:"center",flexWrap:"wrap",children:[e.jsx(N,{label:"學制",options:ue,value:l.school_level||[],onChange:o=>f("school_level",o),minWidth:"100px"}),e.jsx(N,{label:"年級",options:At,value:l.grades||0,onChange:o=>f("grades",o),minWidth:"100px"}),t===O.ROLE_ADMIN||t===O.ROLE_MANAGER?e.jsx(w,{label:"學校名稱",labelSx:{width:"80%"},value:l.school_name,onChange:o=>f("school_name",o),onKeyDown:o=>J(o,d)}):e.jsx(N,{label:"學校名稱",options:a,value:l.school_name,onChange:o=>f("school_name",o)}),e.jsxs(X,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsx(G,{label:"開始時間",format:"YYYY-MM-DD",value:j(l.start_date).toDate().getTime(),onChange:o=>v("start_date",o)}),e.jsx(G,{label:"結束時間",format:"YYYY-MM-DD",value:j(l.end_date).toDate().getTime(),onChange:o=>v("end_date",o)})]}),e.jsx(T,{label:"搜尋",onClick:d,btnColor:"BROWN"})]}),e.jsx("iframe",{height:"100%",width:"100%",src:s},s)]})},$t=Et,Rt=["小一","小二","小三","小四","小五","小六","國一","國二","國三","高一","高二","高三","大一","大二","大三","大四"],It=Rt.map((n,t)=>({label:n,value:t+1})),de=[{label:"全部",value:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},{label:"國小",value:[1,2,3,4,5,6]},{label:"國中",value:[7,8,9]},{label:"高中",value:[10,11,12]},{label:"大學",value:[13,14,15,16]}],Re=(n,t)=>{const a={...t};a.start_date=j(a.start_date).startOf("day").format("YYYY-MM-DD HH:mm:ss"),a.end_date=j(a.end_date).endOf("day").format("YYYY-MM-DD HH:mm:ss"),a.grades===0&&a.school_level&&(a.grades=a.school_level.join(",")),Array.isArray(a.school_level)&&a.school_level.length===de[0].value.length&&(delete a.school_level,delete a.grades);const i=[...Object.keys(a),"grades"].join(","),r=Object.entries(a).filter(([u,l])=>l!==void 0&&l!=="").map(([u,l])=>`${u}=${l}`).join("&");return`${n}${r}#hide_parameters=${i}&titled=false`},Mt=()=>{var g;const{userInfo:n,role:t}=z(),a=n.schoolDtoList.map(o=>({label:o.schoolName,value:o.schoolName})),[s,i]=c.useState(""),[r,u]=c.useState(""),[l,x]=c.useState({grades:0,school_level:de[0].value,school_name:t===O.ROLE_ADMIN||t===O.ROLE_MANAGER?"":(g=a[0])==null?void 0:g.value,start_date:j().subtract(1,"month").startOf("day").format("YYYY-MM-DD"),end_date:j().endOf("day").format("YYYY-MM-DD"),is_admin:t===O.ROLE_ADMIN?1:null}),{data:h}=B({variable:"CUSTOM_DATE_RANGE_PLAYER_POINT_RANK",page:0,size:10,onlySelf:!1}),f=c.useCallback((o,m)=>{o==="grades"&&m.target.value?x(b=>({...b,[o]:m.target.value,school_level:[]})):o==="school_level"&&m.target.value?x(b=>({...b,[o]:m.target.value,grades:0})):x(b=>({...b,[o]:m.target.value}))},[]),v=c.useCallback((o,m)=>{x(b=>({...b,[o]:m})),console.log(m)},[]),d=c.useCallback(()=>{i(Re(r,l))},[r,l]);return c.useEffect(()=>{h!=null&&h.content[0]&&(u(h.content[0].value+"?"),i(Re(h.content[0].value+"?",l)))},[h]),e.jsxs("div",{style:{height:"100vh",width:"100%"},children:[e.jsxs(y,{flexDirection:"row",width:"100%",gap:3,mb:3,alignItems:"center",flexWrap:"wrap",children:[e.jsx(N,{label:"學制",options:de,value:l.school_level||[],onChange:o=>f("school_level",o),minWidth:"100px"}),e.jsx(N,{label:"年級",options:It,value:l.grades||0,onChange:o=>f("grades",o),minWidth:"100px"}),t===O.ROLE_ADMIN||t===O.ROLE_MANAGER?e.jsx(w,{label:"學校名稱",labelSx:{width:"80%"},value:l.school_name,onChange:o=>f("school_name",o),onKeyDown:o=>J(o,d)}):e.jsx(N,{label:"學校名稱",options:a,value:l.school_name,onChange:o=>f("school_name",o)}),e.jsxs(X,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsx(G,{label:"開始時間",format:"YYYY-MM-DD",value:j(l.start_date).toDate().getTime(),onChange:o=>v("start_date",o)}),e.jsx(G,{label:"結束時間",format:"YYYY-MM-DD",value:j(l.end_date).toDate().getTime(),onChange:o=>v("end_date",o)})]}),e.jsx(T,{label:"搜尋",onClick:d,btnColor:"BROWN"})]}),e.jsx("iframe",{height:"100%",width:"100%",src:s},s)]})},Yt=Mt,Ie=[{label:"玩家暱稱",value:"nick_name"},{label:"黑洞關卡名稱",value:"black_hole_stage_name"},{label:"關卡名稱",value:"stage_name"},{label:"任務名稱",value:"mission_name"}],Me=(n,t)=>{const a=Object.entries(t).map(([r,u])=>(r==="chapter_name"&&u==="全選"&&(u=""),r==="chapter_type"&&u===0&&(u=""),r==="is_victory"&&u===!1&&(u=""),`${r}=${u||""}`)).join("&"),s=Object.keys(t).join(",");return`${n}${a}#hide_parameters=${s}&titled=false`},kt=()=>{const[n,t]=c.useState(""),[a,s]=c.useState(""),i={searchText:"",currentField:"nick_name"},[r,u]=c.useState(i),[l,x]=c.useState({chapter_type:0,chapter_name:"全選",start_time:"",end_time:"",nick_name:"",black_hole_stage_name:"",stage_name:"",mission_name:"",is_victory:!1}),{data:h}=B({variable:"BLACK_HOLE_LOG_DASHBOARD",page:0,size:10,onlySelf:!1}),{data:f}=Ia(!1),v=c.useMemo(()=>[{label:"全選",value:"全選"},...(f==null?void 0:f.map(p=>({label:p,value:p})))||[]],[f]),d=(p,S)=>{x(_=>({..._,[p]:S.target.value}))},g=c.useCallback(p=>{u(S=>({...S,searchText:p}))},[u]),o=c.useCallback(()=>{const{currentField:p,searchText:S}=r,_=Object.fromEntries(Ie.map(D=>[D.value,""])),C={...l,..._,[p]:S};x(C),t(Me(a,C))},[r,a,l]),m=c.useCallback(p=>{u(S=>({...S,currentField:p}))},[]),b=(p,S)=>{S&&x(_=>({..._,[p]:j(S).format("YYYY-MM-DD HH:mm:ss")}))};return c.useEffect(()=>{if(h!=null&&h.content[0]){const p=h.content[0].value+"?";s(p),t(Me(p,l))}},[h]),e.jsxs(y,{width:"100%",minHeight:"80vh",gap:5,children:[e.jsxs(y,{flexDirection:"row",gap:3,children:[e.jsx(N,{label:"章節類型",options:Ma,value:(l==null?void 0:l.chapter_type)||0,onChange:p=>d("chapter_type",p)}),e.jsx(N,{label:"黑洞章節",options:v,value:(l==null?void 0:l.chapter_name)||"全選",onChange:p=>d("chapter_name",p),minWidth:"240px"}),e.jsxs(X,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(G,{label:"開始時間",format:"YYYY-MM-DD HH:mm:ss",value:j(l.start_time).toDate().getTime(),onChange:p=>b("start_time",p)}),e.jsx(P,{variant:"h6",children:"至"}),e.jsx(xe,{format:"YYYY-MM-DD HH:mm:ss",value:j(l.end_time).toDate().getTime(),onChange:p=>b("end_time",p)})]})]}),e.jsxs(y,{flexDirection:"row",alignItems:"center",gap:3,children:[e.jsx(fe,{options:Ie,value:r,selectOnChange:m,inputOnChange:g,searchFuntion:o,check:l.is_victory,checkLabel:"是否通關",checkBoxOnChange:p=>d("is_victory",{target:{value:p?1:0}})}),e.jsx(T,{label:"搜尋",onClick:o,btnColor:"BROWN"})]}),e.jsx("iframe",{src:n,width:"100%",height:"100%",style:{flex:1}})]})},Pt=kt,Tt=[{label:"全選",value:0},{label:"1",value:1},{label:"2",value:2},{label:"3",value:3},{label:"4",value:4}],Ye=[{label:"玩家暱稱",value:"nick_name"},{label:"黑洞章節名稱",value:"chapter_name"}],ke=(n,t)=>{const a=Object.entries(t).map(([r,u])=>(r==="answer_round"&&u===0&&(u=""),`${r}=${u||""}`)).join("&"),s=Object.keys(t).join(",");return`${n}${a}#hide_parameters=${s}&titled=false`},Gt=()=>{const[n,t]=c.useState(""),[a,s]=c.useState(""),i={searchText:"",currentField:"nick_name"},[r,u]=c.useState(i),[l,x]=c.useState({answer_round:0,start_time:"",end_time:"",nick_name:"",chapter_name:""}),{data:h}=B({variable:"OIL_STAGE_LOG_DASHBOARD",page:0,size:10,onlySelf:!1}),f=(m,b)=>{x(p=>({...p,[m]:b.target.value}))},v=(m,b)=>{b&&x(p=>({...p,[m]:j(b).format("YYYY-MM-DD HH:mm:ss")}))},d=c.useCallback(m=>{u(b=>({...b,searchText:m}))},[u]),g=c.useCallback(()=>{const{currentField:m,searchText:b}=r,p=Object.fromEntries(Ye.map(_=>[_.value,""])),S={...l,...p,[m]:b};x(S),t(ke(a,S))},[r,a,l]),o=c.useCallback(m=>{u(b=>({...b,currentField:m}))},[]);return c.useEffect(()=>{if(h!=null&&h.content[0]){const m=h.content[0].value+"?";s(m),t(ke(m,l))}},[h]),e.jsxs(y,{width:"100%",minHeight:"80vh",gap:5,children:[e.jsxs(y,{flexDirection:"row",gap:3,flexWrap:"wrap",children:[e.jsx(N,{label:"總作答輪次",options:Tt,value:l.answer_round||0,onChange:m=>f("answer_round",m),minWidth:"160px"}),e.jsxs(X,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(G,{label:"開始時間",format:"YYYY-MM-DD HH:mm:ss",value:j(l.start_time).toDate().getTime(),onChange:m=>v("start_time",m)}),e.jsx(P,{variant:"h6",children:"至"}),e.jsx(xe,{format:"YYYY-MM-DD HH:mm:ss",value:j(l.end_time).toDate().getTime(),onChange:m=>v("end_time",m)})]}),e.jsxs(y,{flexDirection:"row",alignItems:"center",gap:3,children:[e.jsx(fe,{options:Ye,value:r,selectOnChange:o,inputOnChange:d,searchFuntion:g}),e.jsx(T,{label:"搜尋",onClick:g,btnColor:"BROWN"})]})]}),e.jsx("iframe",{src:n,width:"100%",height:"100%",style:{flex:1}})]})},wt=Gt,oe=class oe{};oe.AI_ASSISTANT="/aiAssistant",oe.AI_ASSISTANT_NAME_LIST="/aiAssistant/nameList";let le=oe;async function Ht(n){try{return(await re.get(le.AI_ASSISTANT_NAME_LIST,{params:{removed:n}})).data.data}catch(t){throw new Error(`getAiAssistantNameList, ${t}`)}}function Ut(n){return he({queryKey:[le.AI_ASSISTANT_NAME_LIST,n],queryFn:()=>Ht(n)})}const Pe=[{label:"玩家暱稱",value:"nick_name"},{label:"任務名稱",value:"mission_name"},{label:"關鍵字",value:"key_word"}],Ft=[{label:"全選",value:"全選"},{label:"單人",value:"單人"},{label:"協作",value:"協作"},{label:"陣營",value:"陣營"},{label:"黑洞",value:"黑洞"}],Te=(n,t)=>{const a=Object.entries(t).map(([r,u])=>((r==="mode"||r==="ai_assistant_name")&&u==="全選"&&(u=""),`${r}=${u||""}`)).join("&"),s=Object.keys(t).join(",");return`${n}${a}#hide_parameters=${s}&titled=false`},Bt=()=>{const[n,t]=c.useState(""),[a,s]=c.useState(""),i={searchText:"",currentField:"nick_name"},[r,u]=c.useState(i),[l,x]=c.useState({mode:"全選",ai_assistant_name:"全選",start_time:"",end_time:"",nick_name:"",mission_name:"",key_word:""}),{data:h}=B({variable:"AI_CHAT_LOG_DASHBOARD",page:0,size:10,onlySelf:!1}),{data:f}=Ut(!1),v=c.useMemo(()=>[{label:"全選",value:"全選"},...(f==null?void 0:f.map(p=>({label:p,value:p})))||[]],[f]),d=(p,S)=>{x(_=>({..._,[p]:S.target.value}))},g=c.useCallback(p=>{u(S=>({...S,searchText:p}))},[u]),o=c.useCallback(()=>{const{currentField:p,searchText:S}=r,_=Object.fromEntries(Pe.map(D=>[D.value,""])),C={...l,..._,[p]:S};x(C),t(Te(a,C))},[r,a,l]),m=c.useCallback(p=>{u(S=>({...S,currentField:p}))},[]),b=(p,S)=>{S&&x(_=>({..._,[p]:j(S).format("YYYY-MM-DD HH:mm:ss")}))};return c.useEffect(()=>{if(h!=null&&h.content[0]){const p=h.content[0].value+"?";s(p),t(Te(p,l))}},[h]),e.jsxs(y,{width:"100%",minHeight:"80vh",gap:5,children:[e.jsxs(y,{flexDirection:"row",gap:3,children:[e.jsx(N,{label:"模式",options:Ft,value:(l==null?void 0:l.mode)||"全選",onChange:p=>d("mode",p)}),e.jsx(N,{label:"AI 導師名稱",options:v,value:(l==null?void 0:l.ai_assistant_name)||"全選",onChange:p=>d("ai_assistant_name",p),minWidth:"160px"}),e.jsxs(X,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(G,{label:"提問時間",format:"YYYY-MM-DD HH:mm:ss",value:j(l.start_time).toDate().getTime(),onChange:p=>b("start_time",p)}),e.jsx(P,{variant:"h6",children:"至"}),e.jsx(xe,{format:"YYYY-MM-DD HH:mm:ss",value:j(l.end_time).toDate().getTime(),onChange:p=>b("end_time",p)})]})]}),e.jsxs(y,{flexDirection:"row",alignItems:"center",gap:3,children:[e.jsx(fe,{options:Pe,value:r,selectOnChange:m,inputOnChange:g,searchFuntion:o}),e.jsx(T,{label:"搜尋",onClick:o,btnColor:"BROWN"})]}),e.jsx("iframe",{src:n,width:"100%",height:"100%",style:{flex:1}})]})},Wt=Bt;function an(){return e.jsxs(ba,{children:[e.jsx(A,{index:!0,path:"/studentStats",element:e.jsx($,{element:e.jsx(Ct,{}),permissionKey:"ROLE_PERMISSIONS_VIEW_SCHOOL_STUDENTS"})}),e.jsx(A,{index:!0,path:"/studentMonthStats",element:e.jsx($,{element:e.jsx(St,{}),permissionKey:"ROLE_PERMISSIONS_VIEW_SCHOOL_STUDENTS"})}),e.jsx(A,{index:!0,path:"/studentRankingDetail",element:e.jsx($,{element:e.jsx(bt,{}),permissionKey:"ROLE_PERMISSIONS_MISSION"})}),e.jsx(A,{index:!0,path:"/schoolRankingDetail",element:e.jsx($,{element:e.jsx(ft,{}),permissionKey:"ROLE_PERMISSIONS_MISSION"})}),e.jsx(A,{index:!0,path:"/behaviorLog",element:e.jsx($,{element:e.jsx(st,{}),permissionKey:"ROLE_PERMISSIONS_VIEW_SCHOOL_STUDENTS"})}),e.jsx(A,{index:!0,path:"/blackHoleLog",element:e.jsx($,{element:e.jsx(Pt,{}),permissionKey:"ROLE_PERMISSIONS_VIEW_SCHOOL_STUDENTS"})}),e.jsx(A,{index:!0,path:"/oilStageLog",element:e.jsx($,{element:e.jsx(wt,{}),permissionKey:"ROLE_PERMISSIONS_VIEW_SCHOOL_STUDENTS"})}),e.jsx(A,{index:!0,path:"/aiChatLog",element:e.jsx($,{element:e.jsx(Wt,{}),permissionKey:"ROLE_PERMISSIONS_VIEW_SCHOOL_STUDENTS"})}),e.jsx(A,{index:!0,path:"/learningLog",element:e.jsx($,{element:e.jsx(ct,{}),permissionKey:"ROLE_PERMISSIONS_MISSION"})}),e.jsx(A,{index:!0,path:"/periodLoginAndPlayCount",element:e.jsx($,{element:e.jsx(Dt,{}),permissionKey:"ROLE_PERMISSIONS_VIEW_SCHOOL_STUDENTS"})}),e.jsx(A,{index:!0,path:"/periodPlayList",element:e.jsx($,{element:e.jsx($t,{}),permissionKey:"ROLE_PERMISSIONS_VIEW_SCHOOL_STUDENTS"})}),e.jsx(A,{index:!0,path:"/periodBattleScoreRank",element:e.jsx($,{element:e.jsx(Yt,{}),permissionKey:"ROLE_PERMISSIONS_VIEW_SCHOOL_STUDENTS"})}),e.jsx(A,{path:"*",element:e.jsx(va,{to:"/",replace:!0})})]})}export{an as default};
